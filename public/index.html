<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BubbleChat</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body { background: white; font-family: Arial, sans-serif; padding: 20px; }
#chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; }
#msg { width: 70%; }
#send { padding: 5px 10px; }
.nickname { font-weight: bold; cursor: pointer; }
.private { background: #f0f8ff; padding: 2px 4px; border-radius: 4px; }
#users { margin-top: 10px; }
</style>
</head>
<body>

<h1>BubbleChat</h1>

<div id="login">
  <input id="nick" placeholder="Ник"><br><br>
  <button onclick="login()">Войти</button>
</div>

<div id="chatBlock" style="display:none;">
  <div id="chat"></div><br>
  <input id="msg" placeholder="Сообщение">
  <button id="send" onclick="sendMsg()">Отправить</button>
  <div id="users"></div>
</div>

<script>
const socket = io();
let nick = "";
let privateTo = null;

const colors = ["red","green","blue","purple","orange","teal","brown"];

function login() {
  nick = document.getElementById("nick").value.trim();
  if (!nick) return;
  document.getElementById("login").style.display = "none";
  document.getElementById("chatBlock").style.display = "block";
  socket.emit("register", nick);
}

function sendMsg() {
  const text = document.getElementById("msg").value.trim();
  if (!text) return;
  socket.emit("chat message", { text, to: privateTo });
  document.getElementById("msg").value = "";
}

socket.on("chat message", (data) => {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  const color = colors[data.nick.charCodeAt(0) % colors.length];
  const privateTag = data.private ? <span class="private">[ЛС]</span> : "";
  div.innerHTML = <span class="nickname" style="color:${color}" onclick="startPrivate('${data.nick}')">${data.nick}</span>${privateTag}: ${data.text};
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});

socket.on("users", (list) => {
  const usersDiv = document.getElementById("users");
  usersDiv.innerHTML = "Пользователи онлайн: " + list.filter(u => u !== nick).join(", ");
});

function startPrivate(user) {
  if (user === nick) return;
  privateTo = user;
  alert("Вы начали ЛС с " + user);
}
</script>

</body>
</html>